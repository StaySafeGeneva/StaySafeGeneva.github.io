---
layout: page
title: test feel lucky
permalink: /retest/
---


<div id="searchfield">
  <h3>Search for a road... <a id="randomlink" onclick="displayRandom();">or
      feel lucky !</a></h3>
  <form>
    <input type="text" name="race" class="biginput" id="autocomplete"
    value="Type a location or a name here..."
    onblur="if (this.value==''){this.value='Type a location or a name here...';}"
    onfocus="if (this.value!=''){this.value='';}">
  </form>
</div>

<div id="outputbox">
  <p id="outputcontent">Choose a race and the results will display here.</p>
</div>


<script type="text/javascript">
// Query
var url = window.location.href;
var raceQuery = null;
if (url.split("?").length > 1) {
  raceQuery = url.split('?').pop().split('=').pop();
}
// Races hashtable
var races = [
  {% for race in site.data.road_risk.Risk_NB_VOITURES_TOURISME %}
  {value:"{{race[1]}}",data:"{{race[0]}}"},
  {% endfor %}
];
// Initializations
var currentRace = null;
var myMap = null;
</script>

<script type="text/javascript">

/* Display information for a randomly chosen race */
function displayRandom() {
  // Get random index
  var entry = Math.floor(Math.random() * races.length);
  // Load JSON file and display
  loadAndDisplay(races[entry].data, races[entry].value)
}

function loadAndDisplay(road,risk) {
  $("<div id='outputbox'><p id='outputcontent'>Loading... Please wait.</p><img src='../img/CHflag.gif' ></div>").replaceAll("#outputbox")
  // Load JSON data

  $.getJSON("/_data/" + "road_risk" + ".json", function(data) {
    // Set 'global' var to selected race
    currentRace = data

	$('<div id="outputbox"><p id="outputcontent">Choose a runner and the results will be displayed here.</p></div>').replaceAll('#outputbox')

    // Empty HTML
    $('#outputbox').empty()

    // ---- TITLE ----
    var title = "<h2>"+ "cacaaaaa" +"</h2>"
    $('#outputbox').append(title)

  })
}

/* Callback function for race selection through search bar */
$(function(){
  $('#autocomplete').autocomplete({
    lookup: races.data,
    onSelect: function (suggestion) {
      loadAndDisplay(suggestion.data)
    }
  });
});

// Page load end : check if a query has been made
if (raceQuery) {
  loadAndDisplay(raceQuery);
}
</script>
